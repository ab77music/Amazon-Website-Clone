{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/abela/OneDrive/Desktop/evangadi fullstuck class August 1st batch 2020/Phase 3/Amazon-website/amazon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/abela/OneDrive/Desktop/evangadi fullstuck class August 1st batch 2020/Phase 3/Amazon-website/amazon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/abela/OneDrive/Desktop/evangadi fullstuck class August 1st batch 2020/Phase 3/Amazon-website/amazon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Link,useHistory}from\"react-router-dom\";import React,{useState,useEffect}from'react';import\"./Payment.css\";import{useStateValue}from'./StateProvider';import CheckoutProduct from'./CheckoutProduct';import{CardElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import CurrencyFormat from\"react-currency-format\";import axios from\"./axios\";import{db}from\"./firebase\";function Payment(){var _useStateValue=useStateValue(),_useStateValue2=_slicedToArray(_useStateValue,2),_useStateValue2$=_useStateValue2[0],basket=_useStateValue2$.basket,users=_useStateValue2$.users,dispatch=_useStateValue2[1];var history=useHistory();var getBasketTotal=function getBasketTotal(basket){return basket===null||basket===void 0?void 0:basket.reduce(function(amount,item){return item.price+amount;},0);};var stripe=useStripe();var elements=useElements();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),disabled=_useState4[0],setDisabled=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),succeeded=_useState6[0],setSucceeded=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),processing=_useState8[0],setProcessing=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),clientSecret=_useState10[0],setClientSecret=_useState10[1];useEffect(function(){//*special stripe secret allow us to charge a customer\nvar getClientSecret=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios({method:\"post\",url:\"/payments/create?total=${getBasketTotal(basket)*100}\"});case 2:response=_context.sent;setClientSecret(response.data.clientSecret);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getClientSecret(){return _ref.apply(this,arguments);};}();getClientSecret();},[basket]);console.log(\"THE SECRET IS SECRET>>>>>\",clientSecret);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var payload;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();setProcessing(true);_context2.next=4;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement)}}).then(function(_ref3){var paymentIntent=_ref3.paymentIntent;//*Payment confirmation\ndb.collection(\"users\").doc(users===null||users===void 0?void 0:users.uid).collection(\"orders\").doc(paymentIntent.id).set({basket:basket,amount:paymentIntent.amount,created:paymentIntent.created});setSucceeded(true);setError(null);setProcessing(false);dispatch({type:\"EMPTY_BASKET\"});history.replaceState(\"/orders\");});case 4:payload=_context2.sent;case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var handleChange=function handleChange(event){setDisabled(event.error?event.error.message:\"\");};return/*#__PURE__*/_jsx(\"div\",{className:\"payment\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment__container\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Checkout (\",/*#__PURE__*/_jsxs(Link,{to:\"/checkout\",children:[basket===null||basket===void 0?void 0:basket.length,\"items\"]}),\")\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment__title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Delivery Address\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__address\",children:[/*#__PURE__*/_jsx(\"p\",{children:users===null||users===void 0?void 0:users.email}),/*#__PURE__*/_jsx(\"p\",{children:\"7570 W Flamingo,Las Vegas NV\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment__title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Review Items and Delivery\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment__items\",children:basket.map(function(item){return/*#__PURE__*/_jsx(CheckoutProduct,{id:item.id,title:item.title,image:item.image,price:item.price,rating:item.rating});})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment__title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Payment Method\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment__details\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{onChange:handleChange}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__priceContainer\",children:[/*#__PURE__*/_jsx(CurrencyFormat,{renderText:function renderText(value){return/*#__PURE__*/_jsxs(\"h3\",{children:[\"Order Total:\",value]});},decimalScale:2,value:getBasketTotal(basket),displayType:\"text\",prefix:\"$\"}),/*#__PURE__*/_jsx(\"button\",{disabled:processing||disabled||succeeded,children:/*#__PURE__*/_jsx(\"span\",{children:processing?/*#__PURE__*/_jsx(\"p\",{children:\"Processing\"}):\"Buy Now\"})})]}),error&&/*#__PURE__*/_jsx(\"div\",{children:error})]})})]})]})});}export default Payment;","map":{"version":3,"sources":["C:/Users/abela/OneDrive/Desktop/evangadi fullstuck class August 1st batch 2020/Phase 3/Amazon-website/amazon/src/Payment.js"],"names":["Link","useHistory","React","useState","useEffect","useStateValue","CheckoutProduct","CardElement","useStripe","useElements","CurrencyFormat","axios","db","Payment","basket","users","dispatch","history","getBasketTotal","reduce","amount","item","price","stripe","elements","error","setError","disabled","setDisabled","succeeded","setSucceeded","processing","setProcessing","clientSecret","setClientSecret","getClientSecret","method","url","response","data","console","log","handleSubmit","event","preventDefault","confirmCardPayment","payment_method","card","getElement","then","paymentIntent","collection","doc","uid","id","set","created","type","replaceState","payload","handleChange","message","length","email","map","title","image","rating","value"],"mappings":"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","sourcesContent":["\r\nimport { Link, useHistory } from \"react-router-dom\";\r\nimport React, { useState, useEffect } from 'react'\r\nimport \"./Payment.css\";\r\nimport { useStateValue } from './StateProvider';\r\nimport CheckoutProduct from './CheckoutProduct';\r\nimport { CardElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\r\nimport CurrencyFormat from \"react-currency-format\";\r\nimport axios from \"./axios\";\r\nimport { db } from \"./firebase\";\r\n\r\n\r\nfunction Payment() {\r\n  const [{ basket, users }, dispatch] = useStateValue();\r\n  const history = useHistory();\r\n\r\n  const getBasketTotal = (basket) =>\r\n    basket?.reduce((amount, item) => item.price + amount, 0);\r\n\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n\r\n  const [error, setError] = useState(null);\r\n  const [disabled, setDisabled] = useState(true);\r\n\r\n  const [succeeded, setSucceeded] = useState(false);\r\n  const [processing, setProcessing] = useState(\"\");\r\n\r\n  const [clientSecret, setClientSecret] = useState(true)\r\n\r\n  useEffect(() => {\r\n    //*special stripe secret allow us to charge a customer\r\n    const getClientSecret = async () => {\r\n      const response = await axios({\r\n        method: \"post\",\r\n        url: \"/payments/create?total=${getBasketTotal(basket)*100}\",\r\n      });\r\n      setClientSecret(response.data.clientSecret);\r\n    };\r\n    getClientSecret();\r\n\r\n  }, [basket]);\r\n  console.log(\"THE SECRET IS SECRET>>>>>\", clientSecret)\r\n\r\n  const handleSubmit = async (event) => {\r\n    event.preventDefault();\r\n    setProcessing(true);\r\n    const payload = await stripe.confirmCardPayment(clientSecret, {\r\n      payment_method: {\r\n        card: elements.getElement(CardElement),\r\n      },\r\n    }).then(({ paymentIntent }) => {\r\n      //*Payment confirmation\r\n      db.collection(\"users\").doc(users?.uid).collection(\"orders\").doc(paymentIntent.id)\r\n        .set({\r\n          basket: basket,\r\n          amount: paymentIntent.amount,\r\n          created: paymentIntent.created,\r\n        });\r\n\r\n      setSucceeded(true);\r\n      setError(null);\r\n      setProcessing(false);\r\n      dispatch({\r\n        type: \"EMPTY_BASKET\",\r\n      });\r\n      history.replaceState(\"/orders\")\r\n\r\n    });\r\n  };\r\n\r\n  const handleChange = (event) => {\r\n    setDisabled(event.error ? event.error.message : \"\");\r\n  };\r\n  return (\r\n    <div className=\"payment\">\r\n      <div className=\"payment__container\">\r\n        <h1>\r\n          Checkout (<Link to=\"/checkout\">{basket?.length}items</Link>)\r\n         </h1>\r\n        <div className=\"payment__section\">\r\n          <div className=\"payment__title\">\r\n            <h3>Delivery Address</h3>\r\n          </div>\r\n          <div className=\"payment__address\">\r\n            <p>{users?.email}</p>\r\n            <p>7570 W Flamingo,Las Vegas NV</p>\r\n\r\n          </div>\r\n        </div>\r\n        <div className=\"payment__section\">\r\n          <div className=\"payment__title\">\r\n            <h3>Review Items and Delivery</h3>\r\n          </div>\r\n          <div className=\"payment__items\">\r\n            {basket.map((item) => (\r\n              <CheckoutProduct\r\n                id={item.id}\r\n                title={item.title}\r\n                image={item.image}\r\n                price={item.price}\r\n                rating={item.rating}\r\n              />\r\n            ))}\r\n\r\n          </div>\r\n        </div>\r\n        <div className=\"payment__section\">\r\n          <div className=\"payment__title\">\r\n            <h3>Payment Method</h3>\r\n          </div>\r\n          <div className=\"payment__details\">\r\n            <form onSubmit={handleSubmit}>\r\n              <CardElement onChange={handleChange} />\r\n              <div className=\"payment__priceContainer\">\r\n                <CurrencyFormat\r\n                  renderText={(value) => <h3>Order Total:{value}</h3>}\r\n                  decimalScale={2}\r\n                  value={getBasketTotal(basket)}\r\n                  displayType={\"text\"}\r\n                  prefix={\"$\"}\r\n                />\r\n                <button disabled={processing || disabled || succeeded}>\r\n                  <span>{processing ? <p>Processing</p> : \"Buy Now\"}</span>\r\n                </button>\r\n              </div>\r\n              {error && <div>{error}</div>}\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Payment\r\n"]},"metadata":{},"sourceType":"module"}